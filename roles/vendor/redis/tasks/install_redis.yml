- name: Download Redis stable
  get_url:
    url: https://download.redis.io/releases/redis-{{redis_stable_version}}.tar.gz
    dest: /tmp/redis.tar.gz
    mode: '0440'
    checksum: sha256:{{redis_sha256}}
  register: download

- name: Unarchive redis tarball build
  unarchive:
    src: /tmp/redis.tar.gz
    dest: /opt
    remote_src: yes
  when: download.changed

- name: Compile Redis
  make:
    chdir: '{{redis_install_dir}}-{{redis_stable_version}}'
    target: install
  when: download.changed
  notify: restart redis
