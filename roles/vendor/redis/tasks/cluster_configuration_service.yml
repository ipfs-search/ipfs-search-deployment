---
- name: Redis port {{ redis_port }} configuration file
  template:
    src: redis_cluster.conf
    dest: /etc/redis_cluster/redis_{{ redis_port }}/redis_{{ redis_port }}.conf
    owner: root
    group: root
    mode: 0644
  register: configuration
- name: Redis port {{ redis_port }} service file
  template:
    src: redis_cluster.service
    dest: /etc/systemd/system/redis_{{ redis_port }}.service
    owner: root
    group: root
    mode: 0644
  register: service
- name: Enable and start service redis_{{ redis_port }}
  systemd:
    name: "redis_{{ redis_port }}"
    daemon_reload: yes
    enabled: yes
    state: started
- name: Restart service
  systemd:
    name: "redis_{{ redis_port }}"
    daemon_reload: yes
    state: restarted
  when: configuration.changed or service.changed
