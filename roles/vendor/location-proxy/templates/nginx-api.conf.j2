server {
    listen 80 default_server;
    listen [::]:80 default_server;

    include /etc/nginx/locations-enabled/*.conf;

    # nsfw-server is provided by a different role.
    location /v1/nsfw/ {
        proxy_pass http://127.0.0.1:{{ nsfw_server_port }}/;
    }

    # nyats-server is provided by a different role.
    location /v1/thumbnail/ {
        proxy_pass http://127.0.0.1:{{ nyats_port }}/thumbnail/;
    }

    location /v1/ {
        proxy_pass http://127.0.0.1:{{ ipfs_search_api_port }}/;
    }

    allow 127.0.0.1;
    allow {{ frontend_ip }};
    deny all;
}
