- name: Check whether {{ es_data_dir }} exists
  stat:
    path: "{{ es_data_dir }}"
  register: es_data_dir_stat
- debug:
    var:
      es_data_dir_stat
- name: Replace {{ data_dir }} by {{ es_data_dir }}
  block:
    - name: Stat {{ data_dir }}
      stat:
        path: "{{ data_dir }}"
      register: data_dir_stat
    - name: Backup {{ data_dir }}
      block:
      - name: Stat {{ data_dir_backup }}
        stat:
          path: "{{ data_dir_backup }}"
        register: data_dir_backup_stat
        failed_when: data_dir_backup_stat.stat.exists
      - pause:
          prompt: "Move {{ data_dir }} to {{ data_dir_backup }}"
      - name: Move {{ data_dir }} to {{ data_dir_backup }}
        command:
          argv:
            - mv
            - "{{ data_dir }}"
            - "{{ data_dir_backup }}"
          removes: "{{ data_dir }}"
          creates: "{{ data_dir_backup }}"
      when: data_dir_stat.stat.exists
    - pause:
        prompt: "Move {{ es_data_dir }} to {{ data_dir }}"
    - name: Move {{ es_data_dir }} to {{ data_dir }}
      command:
        argv:
          - mv
          - "{{ es_data_dir }}"
          - "{{ data_dir }}"
        removes: "{{ es_data_dir }}"
        creates: "{{ data_dir }}"
    - name: Set permissions on {{ data_dir }}
      file:
        path: "{{ data_dir }}"
        state: directory
        owner: "{{ os_user }}"
        group: "{{ os_user }}"
        mode: "u=rwX,g=rwX"
        recurse: true
  when: es_data_dir_stat.stat.exists
