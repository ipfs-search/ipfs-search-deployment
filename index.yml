---
- hosts: index
  become: true
  vars_files:
    - common_variables.yml
  roles:
    - role: elasticsearch
      tags: ['elasticsearch']
      vars:
        oss_version: true
        es_log_dir: "/var/log/elasticsearch"
        es_data_dirs:
          - "/var/lib/elasticsearch"
        es_plugins:
          - plugin: repository-s3
        es_config:
          discovery.type: single-node
          repositories.url.allowed_urls: ["http://localhost:8080/*"]
          network.host: ["_local_", "_site_"]
    - include_playbook: ipfs
    - { name: tika-extractor, tags: ['tika-extractor'] }
    - role: crawler
      tags: ['crawler']
      vars:
        crawler_memlimit: 4G
    - { name: nginx, tags: ['nginx']}
    - { name: api, tags: ['api']}
    - { name: storagebox, tags: ['storagebox'] }
    - { name: snapshots, tags: ['snapshots'] }
